# Авторизация

# Приложение для авторизации пользователей с ролями "Администратор" и "Пользователь"

## Описание

Данное приложение предназначено для авторизации пользователей с разными ролями ("Администратор" и "Пользователь") на основе данных, хранящихся в базе данных. Приложение также обеспечивает функциональность смены пароля администратором при первой авторизации, блокировку аккаунта при нескольких неудачных попытках входа, а также возможность управления пользователями администратором.

## Технические требования

### 1. База данных

•   **Таблица "Пользователи" ("users"):**
    •   Если таблица существует, необходимо проверить наличие следующих полей и при необходимости добавить их:
        *   `id` - Уникальный идентификатор пользователя (целое число, автоинкремент).
        *   `login` - Логин пользователя (строка, уникальное значение).
        *   `password` - Пароль пользователя (строка, хешированный).
        *   `role` - Роль пользователя ("Администратор" или "Пользователь") (строка).
        *   `is_blocked` - Статус блокировки аккаунта (логическое значение, по умолчанию `false`).
        *   `last_login` - Дата и время последней авторизации (дата/время).
        *   `failed_login_attempts` - Количество неудачных попыток входа (целое число, по умолчанию 0).
        *   `created_at` - Дата и время создания записи (дата/время, по умолчанию текущее).
        *   `updated_at` - Дата и время последнего обновления записи (дата/время, по умолчанию текущее).
        *   `password_changed` - Флаг, указывающий на то, был ли пароль изменен после первой авторизации (логическое значение, по умолчанию `false`).

### 2. Форма авторизации

•   **Поля:**
    •   `login` - Текстовое поле для ввода логина (обязательное для заполнения).
    •   `password` - Текстовое поле для ввода пароля (обязательное для заполнения).
    •   Кнопка "Войти".
•   **Логика:**
    •   При нажатии кнопки "Войти" приложение должно:
        1.  Проверить, заполнены ли поля "Логин" и "Пароль".
        2.  Найти пользователя в таблице "Пользователи" по введенному логину.
        3.  Сравнить введенный пароль с хешированным паролем, хранящимся в базе данных.
        4.  Если логин и пароль совпадают:
            *   Обновить поле `last_login` текущей датой и временем.
            *   Установить `failed_login_attempts` в 0.
            *   Вывести сообщение "Вы успешно авторизовались".
            *   Если это первая авторизация администратора (поле `password_changed` равно `false`), то перенаправить на форму смены пароля.
        5.  Если логин или пароль не совпадают, то:
            *   Увеличить `failed_login_attempts` на 1.
            *   Проверить, не превысило ли значение `failed_login_attempts` 3.
            *   Если превысило, то заблокировать аккаунт (установить `is_blocked` в `true`) и вывести сообщение "Вы заблокированы. Обратитесь к администратору".
            *   Если не превысило, то вывести сообщение "Вы ввели неверный логин или пароль. Пожалуйста проверьте ещё раз введенные данные".

### 3. Форма смены пароля (только для администраторов при первой авторизации)

•   **Поля:**
    •   `current_password` - Текстовое поле для ввода текущего пароля (обязательное для заполнения).
    •   `new_password` - Текстовое поле для ввода нового пароля (обязательное для заполнения).
    •   `confirm_new_password` - Текстовое поле для подтверждения нового пароля (обязательное для заполнения).
    •   Кнопка "Изменить пароль".
•   **Логика:**
    •   При нажатии кнопки "Изменить пароль" приложение должно:
        1.  Проверить, заполнены ли все поля формы.
        2.  Сравнить введенный `current_password` с хешированным паролем пользователя в базе данных.
        3.  Сравнить `new_password` с `confirm_new_password`.
        4.  Если все проверки пройдены успешно:
            *   Захешировать `new_password` и сохранить его в базе данных.
            *   Установить `password_changed` в `true`.
            *   Вывести сообщение "Пароль успешно изменен".
        5.  Если какая-либо из проверок не пройдена, вывести соответствующее сообщение об ошибке.

### 4. Блокировка аккаунта

•   **Логика:**
    •   Аккаунт автоматически блокируется:
        *   Если в течение 3-х раз подряд был введен неверный логин/пароль.
        *   Если пользователь не авторизовался в течении 1 месяца (требуется проверка при каждой попытке входа).
•   Заблокированному пользователю при попытке авторизации должно выводиться сообщение: "Вы заблокированы. Обратитесь к администратору".

### 5. Функционал для администратора

•   **Добавление новых пользователей:**
    •   Форма для ввода: `login`, `password`, `role`.
    •   При добавлении нового пользователя, должна производиться проверка на наличие пользователя с таким же логином в базе данных. В случае совпадения, должно выводиться сообщение об ошибке.
•   **Изменение данных пользователей:**
    •   Возможность изменения `role`, снятия блокировки (`is_blocked` = `false`).
    •   Отображение списка пользователей с возможностью их редактирования.

## Технологии

•   **Язык программирования:** C#.
•   **База данных:** MySQL.

## Замечания

•   Пароли пользователей должны храниться в базе данных в хешированном виде.
•   Необходимо предусмотреть защиту от SQL-инъекций.
•   Дизайн интерфейса не является ключевым требованием, фокус на функциональности.
